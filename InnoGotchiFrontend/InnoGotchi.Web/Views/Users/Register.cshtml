@using (Html.BeginForm("Create", "Users", FormMethod.Post, new { enctype = "multipart/form-data" }))
{
    <h3>Registration form</h3>
    <div>
        <label>First name</label><br />
        <input type="text" name="FirstName" /><br />
    </div>
    <div>
        <label>Last name</label><br />
        <input type="text" name="LastName" /> <br />
    </div>
    <div>
        <label>Email</label><br />
        <input type="email" name="Email" /><br />
    </div>
    <div>
        <label>Enter password</label><br />
        <input type="password" name="Password" /><br />
    </div>
    <div id="imageSelector" class="row mb-3">
        <div class="col">
            <label for="formFile" class="form-label">Choose image for avatar (jpg, png)</label>
            <input type="file" name="FormFile" accept=".jpg, .png, .jpeg" class="form-control" id="formFile">
        </div>
        <div id="imageHolder" class="col">
            <img id="avatar" class="img-thumbnail" width="100" height="100" style="opacity:0;vertical-align:central;"/>
        </div>
    </div>
    <div>
        <input type="submit" value="Register" />
    </div>

    <script>

        var input = document.getElementById('formFile');
        input.addEventListener('change', updateImageDisplay);

        function updateImageDisplay() {

            var imageSelector = document.getElementById('imageSelector');
            var image = document.getElementById('avatar')

            while (input.firstChild) {
                console.log(input.firstChild)
                input.removeChild(input.firstChild);
            }
            var curFiles = input.files;
            if (curFiles.length === 0) {
                image.style.opacity = 0;
            }
            else {
                for (var i = 0; i < curFiles.length; i++) {
                    var para = document.createElement('p');
                    if (validFileType(curFiles[i])) {
                        para.textContent = 'File name ' + curFiles[i].name + ', file size ' + returnFileSize(curFiles[i].size) + '.';
                        image.style.opacity = 1;
                        
                        image.src = window.URL.createObjectURL(curFiles[i]);
                    } else {
                        para.textContent = 'File name ' + curFiles[i].name + ': Not a valid file type. Update your selection.';
                        imageSelector.appendChild(para);
                    }
                }
            }

        }

        var fileTypes = [
            'image/jpeg',
            'image/pjpeg',
            'image/png'
        ]

        function validFileType(file) {
            for (var i = 0; i < fileTypes.length; i++) {
                if (file.type === fileTypes[i]) {
                    return true;
                }
            }

            return false;
        }

        function returnFileSize(number) {
            if (number < 1024) {
                return number + 'bytes';
            } else if (number > 1024 && number < 1048576) {
                return (number / 1024).toFixed(1) + 'KB';
            } else if (number > 1048576) {
                return (number / 1048576).toFixed(1) + 'MB';
            }
        }

    </script>
}


